<!doctype html>
<html>
  <head>
    <title>檔案上傳</title>
  </head>
  <body>
    <h1>上傳檔案</h1>
    <p>{{ error }}<p>
    <form method="POST" action="/upload" enctype="multipart/form-data">
      <input type="file" accept=".nii, .nii.gz"  name="file">
      <input type="submit" value="上傳">
    </form>

    <h1>功能選項</h1>
    <p><a href="/show">預覽mri影像</a></p>


    <form method="POST" action="/selModel">
    <p>選擇執行的模型：</p>
    <input type="radio" name="function" value="Multi_labal"> Multi_labal
    <input type="radio" name="function" value="hippocampus"> hippocampus
    <input type="submit" value="進行分割">
    </form>



    <h1>Image</h1>
    <img id="picId1" src="static/sagittal.jpg" alt="Sagittal Plane">
    <img id="picId2" src="static/axial.jpg" alt="Axial Plane">
    <img id="picId3" src="static/coronal.jpg" alt="Coronal Plane">


    <h1>result</h1>
    <img id="picId4" src="static/output_sagittal.jpg" alt="output_Sagittal Plane">
    <img id="picId5" src="static/output_axial.jpg" alt="output_Axial Plane">
    <img id="picId6" src="static/output_coronal.jpg" alt="output_Coronal Plane">


    <script>
        var image1 = document.getElementById("picId1");
        var image2 = document.getElementById("picId2");
        var image3 = document.getElementById("picId3");
        var image4 = document.getElementById("picId4");
        var image5 = document.getElementById("picId5");
        var image6 = document.getElementById("picId6");

        function refreshImage() {
            // 添加随机数参数以强制重新加载图片
            var randomNumber = new Date().getTime();
            image1.src = "static/sagittal.jpg?t=" + randomNumber;
            image2.src = "static/axial.jpg?t=" + randomNumber;
            image3.src = "static/coronal.jpg?t=" + randomNumber;
            image4.src = "static/output_sagittal.jpg?t=" + randomNumber;
            image5.src = "static/output_axial.jpg?t=" + randomNumber;
            image6.src = "static/output_coronal.jpg?t=" + randomNumber;
        }

        setInterval(refreshImage, 500);  // 每秒刷新一次图片
    </script>
    <br>
    <label for="slider1">Sagittal：</label>
    <input type="range" id="slider1" name="slider1" min="0" max="100" step="1" value="50">
    <span id="sliderValue1">50</span>

    <label for="slider2">Axial：</label>
    <input type="range" id="slider2" name="slider2" min="0" max="100" step="1" value="50">
    <span id="sliderValue2">50</span>

    <label for="slider3">Coronal：</label>
    <input type="range" id="slider3" name="slider3" min="0" max="100" step="1" value="50">
    <span id="sliderValue3">50</span>

    <script>
        // 获取滑块元素
        var slider1 = document.getElementById("slider1");
        var slider2 = document.getElementById("slider2");
        var slider3 = document.getElementById("slider3");

        // 获取显示滑块值的元素
        var sliderValue1 = document.getElementById("sliderValue1");
        var sliderValue2 = document.getElementById("sliderValue2");
        var sliderValue3 = document.getElementById("sliderValue3");

        // 获取结果显示的元素
        var result = document.getElementById("result");

        // 更新滑块值
        function updateValues() {
            var value1 = slider1.value;
            var value2 = slider2.value;
            var value3 = slider3.value;
            sliderValue1.textContent = value1;
            sliderValue2.textContent = value2;
            sliderValue3.textContent = value3;

            // 发送数据到服务器
            sendData(value1, value2, value3);
        }

        // 初始化滑块值
        updateValues();

        // 当用户移动滑块时，实时更新值
        slider1.addEventListener("input", updateValues);
        slider2.addEventListener("input", updateValues);
        slider3.addEventListener("input", updateValues);

        // 使用 AJAX 发送数据到服务器
        function sendData(value1, value2, value3) {
            var xhr = new XMLHttpRequest();
            var data = {
                slider1: value1,
                slider2: value2,
                slider3: value3
            };

            xhr.open("POST", "/slider", true);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    result.textContent = "來自 Python 的結果：" + response.result;
                }
            };

            xhr.send(JSON.stringify(data));
        }
    </script>
  </body>
</html>